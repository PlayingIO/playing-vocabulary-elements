<!--
`playing-xvocabulary-edit-layout`
@group Playing UI
@element playing-xvocabulary-edit-layout
-->
<dom-module id="playing-xvocabulary-edit-layout">
  <template>

    <mostly-resource id="directory" path="/directory/[[parentDirectory]]" response="{{parentResponse}}"></mostly-resource>

    <mostly-select role="widget"
            label="[[i18n('vocabularyManagement.edit.parent')]]"
            placeholder="[[i18n('vocabularyManagement.selectParent')]]"
            selected="{{entry.properties.parent}}"
            attr-for-selected="name"
            required>
      <template is="dom-repeat" items="[[parentResponse.entries]]">
        <paper-item name="[[item.properties.id]]">[[item.properties.id]]</paper-item>
      </template>
    </mostly-select>

    <nuxeo-input role="widget"
            label="[[i18n('vocabularyManagement.edit.id')]]"
            name="id"
            value="{{entry.properties.id::change}}"
            readonly$="[[!new]]"
            required></nuxeo-input>

    <nuxeo-input role="widget"
            label="[[i18n('vocabularyManagement.edit.label')]]"
            name="label"
            value="{{entry.properties.label::change}}"></nuxeo-input>

    <div role="widget">
      <label>[[i18n('vocabularyManagement.edit.obsolete')]]</label>
      <paper-toggle-button value="{{entry.properties.label::change}}"
              checked$="[[_isObsolete(entry.properties.obsolete)]]"
              on-change="_obsoleteChanged" noink></paper-toggle-button>
    </div>

    <nuxeo-input role="widget"
            label="[[i18n('vocabularyManagement.edit.ordering')]]"
            name="ordering"
            value="{{entry.properties.ordering::change}}"></nuxeo-input>
  </template>

  <script>
    Polymer({
      is: 'playing-xvocabulary-edit-layout',
      behaviors: [Mostly.I18nBehavior],
      properties: {
        entry: {
          type: Object
        },

        new: {
          type: Boolean,
          value: false
        },

        parentDirectory: {
          type: String,
          observer: '_observeParent'
        }
      },

      _isObsolete: function(obsolete) {
        return obsolete !== null && obsolete !== 0;
      },

      _obsoleteChanged: function() {
        if (this.entry.properties.obsolete > 0) {
          this.entry.properties.obsolete = 0;
        } else {
          this.entry.properties.obsolete = 1;
        }
      },

      _observeParent: function() {
        if (this.parentDirectory && this.parentDirectory.length > 0) {
          this.$.directory.get();
        }
      }

    });
  </script>
</dom-module>
